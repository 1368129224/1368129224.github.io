[{"content":"一、IPv6动态寻址 IPv6动态寻址有三种方式：无状态地址自动配置(SLAAC)、无状态DHCPv6、有状态DHCPv6。\n其中有无状态是指IP地址能否被统一管理，例如：有状态DHCPv6指IP地址由DHCPv6服务器分配，网络管理员能通过DHCPv6服务对IP地址进行统一管理。\n二、RA/RS消息 RA/RS分别是路由通告消息和路由请求消息的缩写，这两个消息类型是ICMPv6邻居发现协议定义的。\n2.1 RA路由通告消息 RA消息由IPv6路由器向多播地址ff02::1发送，目的是宣布自身存在以及向消息发送接口所连链路有关的IPv6地址信息和配置参数，如：链路的IPv6前缀、前缀长度、默认网关的地址、链路最大传输单元(MTU)。\n通常的IPv6路由器会定时向链路发送路由通告消息，如果收到设备发送的RS消息，也会立即发送RA消息。\n2.1.1 A、O、M标志位 RA消息中可携带三种标志位，向IPv6设备建议如何创建或获取地址。\n  A标志位（地址自动配置标记）\n该标志位出现在RA消息的Option中的Prefix Information里。当该标志位打开(置1)时，表示建议主机采用SLAAC方式来创建地址，采用RA消息中的前缀加上接口ID生成地址。\n  O标志位（其他配置标记）\n该标志位出现在RA消息主体里。当该标志位打开(置1)时，表示建议主机采用SLAAC方式来创建地址，通过DHCPv6服务器获取除地址以外的其他地址信息，如：DNS服务器的IP地址和域名。\n  M标志位（管理地址配置标记）\n该标志位出现在RA消息主体里。当该标志位打开(置1)时，表示建议主机从DHCPv6服务器获取地址及所有其他地址信息，只从RA消息中获取IPv6网关地址。\n   M O A IP地址 其他配置     0 0 0 静态设置 手工配置   0 0 1 前缀由 RA 指定，自动生成 手工配置   0 1 0 静态设置 DHCPv6   0 1 1 前缀由 RA 指定，自动生成 DHCPv6   1 0 0 有状态 DHCPv6 DHCPv6   1 0 1 有状态 DHCPv6 和/或 自动生成 DHCPv6   1 1 0 有状态 DHCPv6 DHCPv6   1 1 1 有状态 DHCPv6 和/或 自动生成 DHCPv6      2.2 RS路由恳求消息 RS消息由IPv6设备向多播地址ff02::2发送，源地址是设备的本地链路地址(LLA)或IPv6未指定地址(::)，目的是向IPv6路由器请求链路地址相关的信息。\n三、无状态地址自动配置(SLAAC) 以下是SLAAC配置地址的流程：\n  客户端接口启动成功后，向ff02::2发送RS消息。\n源地址为客户端的本地链路地址(LLA)，目的地址是代表所有IPv6路由器的多播地址。\n  IPv6路由器接收到RS消息后，立即向ff02::1或客户端LLA发送RA消息。\n因为采用SLAAC自动生成地址，所以RA消息中的A标志位置1，O和M标志位置0。\n源地址为IPv6路由器的本地链路地址，目的地址是客户端的本地链路地址，M标志位为0，O标志位为1（M20-8G和AC5客供软件在设置为SLAAC模式后，RA消息中O标志位都置为1，暂不清楚原因）。\n在选项中可以看到：A标志位为1，表示建议客户端自动生成地址；当前链路的MTU位1500；DNS服务器为fc00::ac6:b3ff:feb9:689d\n  客户端使用RA报文中的前缀和接口ID生成IP地址。\n  四、无状态DHCPv6 无状态DHCPv6的地址配置过程与SLAAC类似，但增加了与DHCP服务器交互的过程。以下是无状态DHCPv6配置地址的流程：\n  客户端接口启动成功后，向ff02::2发送RS消息。\n源地址为客户端的本地链路地址(LLA)，目的地址是代表所有IPv6路由器的多播地址。\n  IPv6路由器接收到RS消息后，立即向ff02::1或客户端LLA发送RA消息。\n因为采用SLAAC自动生成地址，所以RA消息中的A和O标志位置1，M标志位置0。\n源地址为IPv6路由器的本地链路地址，目的地址是代表所有IPv6客户端的多播地址，M标志位为0，O标志位为1。\n在选项中可以看到：A标志位为1，表示建议客户端自动生成地址。\n  客户端使用RA报文中的前缀和接口ID生成IP地址。\n  客户端发送DHCPv6恳求消息寻找DHCPv6服务器。\n源地址为客户端本地链路地址，目的地址为代表所有DHCPv6服务器和中继服务器的多播地址ff02::1:2，目的是定位DHCPv6服务器。\n  DHCPv6服务器回应请求，发送DHCPv6通告消息。\nDHCPv6服务器发送通告消息，源地址是DHCPv6服务器本地链路地址，目的地址是客户端的本地链路地址。\n  客户端发送DHCPv6信息请求消息。\n客户端再发送信息请求消息，请求从DHCPv6服务器获取地址参数（不是地址）。\n  DHCPv6服务器回应请求，发送DHCPv6应答消息。\nDHCPv6服务器发送应答消息，其中包含地址参数，如图：DNS服务器地址。\n  五、有状态DHCPv6 有状态DHCPv6地址分配方式即除了IPv6网关信息外，其他所有地址信息都从DHCPv6服务器获取，以下是有状态DHCPv6配置地址的流程：\n 客户端接口启动成功后，向ff02::2发送RS消息。  源地址是客户端本地链路地址，目的地址是ff02::2所有IPv6路由器。\nIPv6路由器接收到RS消息后，立即向ff02::1或客户端LLA发送RA消息。  由于是有状态DHCPv6，A标志位置0，O和M标志位置1。表示建议客户端从DHCPv6服务器获取地址和地址配置。\n 客户端使用RA报文中的IPv6网关地址。\n客户端从RA报文中只采用IPv6网关地址，其他信息从DHCPv6服务器获取。\n  客户端发送DHCPv6恳求消息寻找DHCPv6服务器。\n  ff02::1:2表示所有DHCPv6服务器和中继服务器。\nDHCPv6服务器回应请求，发送DHCPv6通告消息。  客户端发送DHCPv6信息请求消息。   DHCPv6服务器回应请求，发送DHCPv6应答消息。\n  在回应消息中，DHCPv6服务器提供了IP地址及其他的配置信息，如图：DNS服务器地址\n IPv6动态地址分配机制详解\nDHCPv6基础\n ","date":"2022-03-13T18:44:42-07:00","permalink":"https://blog.zooter.com.cn/posts/ipv6lan%E4%BE%A7%E5%8A%A8%E6%80%81%E5%AF%BB%E5%9D%80/","title":"IPv6LAN侧动态寻址"},{"content":"1. 简介 网络地址转换，可以解决IPv4地址匮乏的问题，同时带有过滤的功能(防火墙)。\nPS：在IPv4时代NAT是非常受欢迎的，但随着IPv6的来临，应尽量避免使用NAT，所需的安全(防火墙)等功能应采取其他措施解决。\n2. 术语 2.1 内部Tuple 指内部主机的私有地址和端口号所构成的二元组，即内部主机所发送报文的源地址、端口所构成的二元组。\n2.2 外部Tuple 指内部Tuple经过NAT的源地址/端口转换之后，所获得的外部地址、端口所构成的二元组，即外部主机收到经NAT转换之后的报文时，它所看到的该报文的源地址（通常是NAT设备的地址）和源端口。\n2.3 目标Tuple 指外部主机的地址、端口所构成的二元组，即内部主机所发送报文的目标地址、端口所构成的二元组。\n2.4 Basic NAT（基本NAT） 只进行IP地址转换。在这种模式下，多台内部主机访问外部网络需要同等数量的公网IP地址，即需要一定数量的NAT地址池。\n2.5 NATP（网络地址-端口转换） NATP是在狭义NAT的基础上增加对端口的转换。这种模式下多台内部主机可经由一个公网IP地址访问外部网络，目前家用宽带主要的NAT模式。\n3. NAT的类型 3.1 Full Cone NAT（锥形NAT） 所有来自同一 个内部Tuple X的请求均被NAT转换至同一个外部Tuple Y，而不管这些请求是不是属于同一个应用或者是多个应用的。除此之外，当X-Y的转换关系建立之后，任意外部主机均可随时将Y中的地址和端口作为目标地址和目标端口，向内部主机发送UDP报文，由于对外部请求的来源无任何限制，因此这种方式虽然足够简单，但却不那么安全。（任意的外部主机/port都能和先前内部节点被映射的外部Tuple进行通信）\n3.2 Restricted Cone NAT（受限的锥形NAT） 它是Full Cone的受限版本：所有来自同一个内部Tuple X的请求均被NAT转换至同一个外部Tuple Y，这与Full Cone相同，但不同的是，只有当内部主机曾经发送过报文给外部主机（假设其IP地址为Z）后，外部主机才能以Y中的信息作为目标地址和目标端口，向内部主机发送UDP请求报文，这意味着，NAT设备只向内转发（目标地址/端口转换）那些来自于当前已知的外部主机的UDP报文，从而保障了外部请求来源的安全性。（IP相同，port随便，就能和先前内部节点被映射的外部Tuple进行通信）\n3.3 Port Restricted Cone NAT（严格限制的锥形NAT） 它是Restricted Cone NAT的进一步受限版。只有当内部主机曾经发送过报文给外部主机（假设其IP地址为Z且端口为P）之后，外部主机才能以Y中的信息作为目标地址和目标端 口，向内部主机发送UDP报文，同时，其请求报文的源端口必须为P，这一要求进一步强化了对外部报文请求来源的限制，从而较Restrictd Cone更具安全性 （ip,port都得一样；只能用先前内部节点被映射的外部Tuple与内部节点进行通信））\n3.4 Symmetric NAT（对称NAT） 在Cone NAT中，NAT转换映射关系仅与内部Tuple和外部Tuple相关，与目标Tuple无关。而在Symmetric NAT中，即使内部Tuple和外部Tuple相同，但目标Tuple不同，在此情况下将建立两条转换映射关系。此外，NAT的过滤方式与Port Restricted Cone相同。\n NAT的四种类型及类型检测 - bw_0927 - 博客园\n","date":"2022-03-11T00:03:02-08:00","permalink":"https://blog.zooter.com.cn/posts/nat%E7%AE%80%E4%BB%8B/","title":"NAT简介"},{"content":"802.11k 802.11k协议的功能是Radio Resource Measurment，简单说就是提供找到最好的AP的信息。\n在WLAN中，终端设备总是倾向于连接信号最好的那个AP，而在实际应用中，这种逻辑可能会造成某个AP被过度使用，而信号稍弱的AP则没有怎么用到，从而导致网络的整体利用效率下降。实现802.11k协议的无线网络中，如果信号最好的AP已经满载，则终端设备会连接到信号稍弱的那个AP。\n协议步骤：\n AP决定要踢掉某个终端设备 通知终端设备变换到另一个AP 终端设备请求周围AP的列表 AP给出site report 终端设备根据site report连到某个AP  802.11v 802.11v是802.11协议族的WNM（Wireless Network Management）标准，802.11v协议允许终端设备交换网络拓扑的信息，包括射频环境。\n802.11v描述了WNM的增强，包括：\n Network assisted Power Savings：网络辅助节能，帮助终端设备睡眠更长时间，比如，手机等设备通过每隔一段时间跟AP通讯一次来确保跟AP没有断开 Network assisted Roaming：网络辅助漫游，允许WLAN发送信息给终端，来确保终端能连接更好的AP。  这可以带来两点好处：\n 负载均衡 让信号不好的终端设备更换AP  802.11r 802.11r的功能是快速BSS切换（FT，Fast Basic Service Set Transition），也称为快速漫游（fast roaming），是802.11协议的补充。\n在802.11协议中，AP的切换是由设备控制的（其逻辑是：在能连接到的信号中，挑选信号最好的那个连接，连接一直持续到信号低于一个阈值（通常非常弱）才会断开，然后继续反复）。\n在802.11的初期，切换（handoff）这个操作是非常简单的，一共只有4个握手信息需要传递，但是随着发展，802.11i，802.11X，802.11e等协议的加入，握手的信息越来越多，导致切换AP的时间越来越长。\n802.11r通过重新简化（越来越复杂的）安全握手协议，来实现FT。\n","date":"2022-03-11T10:37:45+08:00","permalink":"https://blog.zooter.com.cn/posts/802.11-kvr/","title":"802.11 kvr协议简述"}]