import{_ as p,W as o,X as r,Y as t,$ as i,a1 as e,a2 as n,C as s,Z as d}from"./framework-5910e262.js";const c="/assets/a5a6a5ca9cade2a6f35faee3e1a6f58c-ca78b8ef.png",f="/assets/2be01e8055cd0a13abc0bef4a00854e2-ee68f69c.png",l="/assets/579ecbd1919d2e8e225aa1c40984009d-f7675672.png",P="/assets/0fd6a51e063c193829bc75fe6bc923ea-7cc20f75.png",v="/assets/483ccb9bd9fb0062c509bd42d52a40d8-7baae008.png",g="/assets/3c8cda5a02605ce905568d06d2be4aa7-a24b9ea5.png",C="/assets/81d575439e67f78ab1104aafe627948c-6702ac22.png",D="/assets/48da0b9401daa245c0ca519e5d0b4447-ef1a4300.png",H="/assets/e72d788e18723fc6a0d48ecc77185e97-344e006f.png",A="/assets/3b29200260366fd33d2f86cb355f1559-f09e3cd9.png",h="/assets/6ba2de6aadb6212109a977f3122b89de-e14dbe53.png",b="/assets/6ec14e58818a0a85eb034437287360c8-3aff83ad.png",_="/assets/28d7ea4b78ee9340f558e1619564b0e2-a0bc29db.png",u="/assets/2144b16db821876f67c3dcf3a8e4c1cb-b855a94f.png",R="/assets/d82033bfdcf38faa6cac8a56f86515f1-1ab77275.png",m="/assets/698b82a7413ac5b30def26ea5f6bfa76-aaa83ced.png",I={},S=n('<h1 id="ipv6动态寻址" tabindex="-1"><a class="header-anchor" href="#ipv6动态寻址" aria-hidden="true">#</a> IPv6动态寻址</h1><h2 id="_1-简介" tabindex="-1"><a class="header-anchor" href="#_1-简介" aria-hidden="true">#</a> 1. 简介</h2><p>IPv6动态寻址有三种方式：无状态地址自动配置(SLAAC)、无状态DHCPv6、有状态DHCPv6。</p><p>其中有无状态是指IP地址能否被统一管理，例如：有状态DHCPv6指IP地址由DHCPv6服务器分配，网络管理员能通过DHCPv6服务对IP地址进行统一管理。</p><h2 id="_2-ra-rs消息" tabindex="-1"><a class="header-anchor" href="#_2-ra-rs消息" aria-hidden="true">#</a> 2. RA/RS消息</h2><p>RA/RS分别是路由通告消息和路由请求消息的缩写，这两个消息类型是ICMPv6邻居发现协议定义的。</p><h3 id="_2-1-ra路由通告消息" tabindex="-1"><a class="header-anchor" href="#_2-1-ra路由通告消息" aria-hidden="true">#</a> 2.1 RA路由通告消息</h3><p>RA消息由IPv6路由器向多播地址<code>ff02::1</code>发送，目的是宣布自身存在以及向消息发送接口所连链路有关的IPv6地址信息和配置参数，如：链路的IPv6前缀、前缀长度、默认网关的地址、链路最大传输单元(MTU)。</p><p>通常的IPv6路由器会定时向链路发送路由通告消息，如果收到设备发送的RS消息，也会立即发送RA消息。</p><h4 id="_2-1-1-a、o、m标志位" tabindex="-1"><a class="header-anchor" href="#_2-1-1-a、o、m标志位" aria-hidden="true">#</a> 2.1.1 A、O、M标志位</h4><p>RA消息中可携带三种标志位，向IPv6设备建议如何创建或获取地址。</p><ul><li><p>A标志位（地址自动配置标记）</p><p>该标志位出现在RA消息的Option中的Prefix Information里。当该标志位打开(置1)时，表示建议主机采用SLAAC方式来创建地址，采用RA消息中的前缀加上接口ID生成地址。</p></li><li><p>O标志位（其他配置标记）</p><p>该标志位出现在RA消息主体里。当该标志位打开(置1)时，表示建议主机采用SLAAC方式来创建地址，通过DHCPv6服务器获取除地址以外的其他地址信息，如：DNS服务器的IP地址和域名。</p></li><li><p>M标志位（管理地址配置标记）</p><p>该标志位出现在RA消息主体里。当该标志位打开(置1)时，表示建议主机从DHCPv6服务器获取地址及所有其他地址信息，只从RA消息中获取IPv6网关地址。</p><table><thead><tr><th>M</th><th>O</th><th>A</th><th>IP地址</th><th>其他配置</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>静态设置</td><td>手工配置</td></tr><tr><td>0</td><td>0</td><td>1</td><td>前缀由 RA 指定，自动生成</td><td>手工配置</td></tr><tr><td>0</td><td>1</td><td>0</td><td>静态设置</td><td>DHCPv6</td></tr><tr><td>0</td><td>1</td><td>1</td><td>前缀由 RA 指定，自动生成</td><td>DHCPv6</td></tr><tr><td>1</td><td>0</td><td>0</td><td>有状态 DHCPv6</td><td>DHCPv6</td></tr><tr><td>1</td><td>0</td><td>1</td><td>有状态 DHCPv6 和/或 自动生成</td><td>DHCPv6</td></tr><tr><td>1</td><td>1</td><td>0</td><td>有状态 DHCPv6</td><td>DHCPv6</td></tr><tr><td>1</td><td>1</td><td>1</td><td>有状态 DHCPv6 和/或 自动生成</td><td>DHCPv6</td></tr></tbody></table></li></ul><h3 id="_2-2-rs路由恳求消息" tabindex="-1"><a class="header-anchor" href="#_2-2-rs路由恳求消息" aria-hidden="true">#</a> 2.2 RS路由恳求消息</h3><p>RS消息由IPv6设备向多播地址<code>ff02::2</code>发送，源地址是设备的本地链路地址(LLA)或IPv6未指定地址(:😃，目的是向IPv6路由器请求链路地址相关的信息。</p><h2 id="_3-无状态地址自动配置-slaac" tabindex="-1"><a class="header-anchor" href="#_3-无状态地址自动配置-slaac" aria-hidden="true">#</a> 3. 无状态地址自动配置(SLAAC)</h2><p>以下是SLAAC配置地址的流程：</p><ol><li><p>客户端接口启动成功后，向<code>ff02::2</code>发送RS消息。</p><figure><img src="'+c+'" alt="SLAAC-RS消息" tabindex="0" loading="lazy"><figcaption>SLAAC-RS消息</figcaption></figure><p>源地址为客户端的本地链路地址(LLA)，目的地址是代表所有IPv6路由器的多播地址。</p></li><li><p>IPv6路由器接收到RS消息后，立即向<code>ff02::1</code>或客户端LLA发送RA消息。</p><p>因为采用SLAAC自动生成地址，所以RA消息中的A标志位置1，O和M标志位置0。</p><figure><img src="'+f+'" alt="SLAAC-RA消息" tabindex="0" loading="lazy"><figcaption>SLAAC-RA消息</figcaption></figure><p>源地址为IPv6路由器的本地链路地址，目的地址是客户端的本地链路地址，M标志位为0，O标志位为1（M20-8G和AC5客供软件在设置为SLAAC模式后，RA消息中O标志位都置为1，暂不清楚原因）。</p><p>在选项中可以看到：A标志位为1，表示建议客户端自动生成地址；当前链路的MTU位1500；DNS服务器为<code>fc00::ac6:b3ff:feb9:689d</code></p></li><li><p>客户端使用RA报文中的前缀和接口ID生成IP地址。</p><figure><img src="'+l+'" alt="SLAAC-网卡信息" tabindex="0" loading="lazy"><figcaption>SLAAC-网卡信息</figcaption></figure></li></ol><h2 id="_4-无状态dhcpv6" tabindex="-1"><a class="header-anchor" href="#_4-无状态dhcpv6" aria-hidden="true">#</a> 4. 无状态DHCPv6</h2><p>无状态DHCPv6的地址配置过程与SLAAC类似，但增加了与DHCP服务器交互的过程。以下是无状态DHCPv6配置地址的流程：</p><ol><li><p>客户端接口启动成功后，向<code>ff02::2</code>发送RS消息。</p><figure><img src="'+c+'" alt="无状态DHCPv6-RS报文" tabindex="0" loading="lazy"><figcaption>无状态DHCPv6-RS报文</figcaption></figure><p>源地址为客户端的本地链路地址(LLA)，目的地址是代表所有IPv6路由器的多播地址。</p></li><li><p>IPv6路由器接收到RS消息后，立即向<code>ff02::1</code>或客户端LLA发送RA消息。</p><p>因为采用SLAAC自动生成地址，所以RA消息中的A和O标志位置1，M标志位置0。</p><figure><img src="'+P+'" alt="无状态DHCPv6-RA报文" tabindex="0" loading="lazy"><figcaption>无状态DHCPv6-RA报文</figcaption></figure><p>源地址为IPv6路由器的本地链路地址，目的地址是代表所有IPv6客户端的多播地址，M标志位为0，O标志位为1。</p><p>在选项中可以看到：A标志位为1，表示建议客户端自动生成地址。</p></li><li><p>客户端使用RA报文中的前缀和接口ID生成IP地址。</p><figure><img src="'+v+'" alt="无状态DHCPv6-网卡信息" tabindex="0" loading="lazy"><figcaption>无状态DHCPv6-网卡信息</figcaption></figure></li><li><p>客户端发送DHCPv6恳求消息寻找DHCPv6服务器。</p><figure><img src="'+g+'" alt="无状态DHCPv6-DHCPv6恳求消息" tabindex="0" loading="lazy"><figcaption>无状态DHCPv6-DHCPv6恳求消息</figcaption></figure><p>源地址为客户端本地链路地址，目的地址为代表所有DHCPv6服务器和中继服务器的多播地址<code>ff02::1:2</code>，目的是定位DHCPv6服务器。</p></li><li><p>DHCPv6服务器回应请求，发送DHCPv6通告消息。</p><figure><img src="'+C+'" alt="无状态DHCPv6-DHCPv6通告消息" tabindex="0" loading="lazy"><figcaption>无状态DHCPv6-DHCPv6通告消息</figcaption></figure><p>DHCPv6服务器发送通告消息，源地址是DHCPv6服务器本地链路地址，目的地址是客户端的本地链路地址。</p></li><li><p>客户端发送DHCPv6信息请求消息。</p><figure><img src="'+D+'" alt="无状态DHCPv6-DHCPv6信息请求消息" tabindex="0" loading="lazy"><figcaption>无状态DHCPv6-DHCPv6信息请求消息</figcaption></figure><p>客户端再发送信息请求消息，请求从DHCPv6服务器获取地址参数（不是地址）。</p></li><li><p>DHCPv6服务器回应请求，发送DHCPv6应答消息。</p><figure><img src="'+H+'" alt="无状态DHCPv6-DHCPv6应答消息" tabindex="0" loading="lazy"><figcaption>无状态DHCPv6-DHCPv6应答消息</figcaption></figure><p>DHCPv6服务器发送应答消息，其中包含地址参数，如图：DNS服务器地址。</p></li></ol><h2 id="_5-有状态dhcpv6" tabindex="-1"><a class="header-anchor" href="#_5-有状态dhcpv6" aria-hidden="true">#</a> 5. 有状态DHCPv6</h2><p>有状态DHCPv6地址分配方式即除了IPv6网关信息外，其他所有地址信息都从DHCPv6服务器获取，以下是有状态DHCPv6配置地址的流程：</p><ol><li>客户端接口启动成功后，向<code>ff02::2</code>发送RS消息。</li></ol><figure><img src="'+A+'" alt="有状态DHCPv6-RS消息" tabindex="0" loading="lazy"><figcaption>有状态DHCPv6-RS消息</figcaption></figure><p>源地址是客户端本地链路地址，目的地址是<code>ff02::2</code>所有IPv6路由器。</p><ol start="2"><li>IPv6路由器接收到RS消息后，立即向<code>ff02::1</code>或客户端LLA发送RA消息。</li></ol><figure><img src="'+h+'" alt="有状态DHCPv6-RA消息" tabindex="0" loading="lazy"><figcaption>有状态DHCPv6-RA消息</figcaption></figure><p>由于是有状态DHCPv6，A标志位置0，O和M标志位置1。表示建议客户端从DHCPv6服务器获取地址和地址配置。</p><ol start="3"><li><p>客户端使用RA报文中的IPv6网关地址。</p><p>客户端从RA报文中只采用IPv6网关地址，其他信息从DHCPv6服务器获取。</p></li><li><p>客户端发送DHCPv6恳求消息寻找DHCPv6服务器。</p></li></ol><figure><img src="'+b+'" alt="有状态DHCPv6-DHCPv6恳求消息" tabindex="0" loading="lazy"><figcaption>有状态DHCPv6-DHCPv6恳求消息</figcaption></figure><p><code>ff02::1:2</code>表示所有DHCPv6服务器和中继服务器。</p><ol start="5"><li>DHCPv6服务器回应请求，发送DHCPv6通告消息。</li></ol><figure><img src="'+_+'" alt="有状态DHCPv6-DHCPv6通告消息" tabindex="0" loading="lazy"><figcaption>有状态DHCPv6-DHCPv6通告消息</figcaption></figure><ol start="6"><li>客户端发送DHCPv6信息请求消息。</li></ol><figure><img src="'+u+'" alt="有状态DHCPv6-DHCPv6信息请求消息" tabindex="0" loading="lazy"><figcaption>有状态DHCPv6-DHCPv6信息请求消息</figcaption></figure><ol start="7"><li><p>DHCPv6服务器回应请求，发送DHCPv6应答消息。</p><figure><img src="'+R+'" alt="有状态DHCPv6-DHCPv6应答消息" tabindex="0" loading="lazy"><figcaption>有状态DHCPv6-DHCPv6应答消息</figcaption></figure></li></ol><p>在回应消息中，DHCPv6服务器提供了IP地址及其他的配置信息，如图：DNS服务器地址</p><figure><img src="'+m+'" alt="不同操作系统寻址方式支持列表" tabindex="0" loading="lazy"><figcaption>不同操作系统寻址方式支持列表</figcaption></figure>',38);function x(L,y){const a=s("RouterLink");return o(),r("div",null,[S,t("blockquote",null,[t("p",null,[i(a,{to:"/posts/Network/img/IPv6%E5%8A%A8%E6%80%81%E5%AF%BB%E5%9D%80/https:/www.packetmania.net/2020/12/01/IPv6-Addressing/"},{default:e(()=>[d("IPv6动态地址分配机制详解")]),_:1})]),t("p",null,[i(a,{to:"/posts/Network/img/IPv6%E5%8A%A8%E6%80%81%E5%AF%BB%E5%9D%80/https:/cshihong.github.io/2018/02/01/DHCPv6%E5%9F%BA%E7%A1%80/"},{default:e(()=>[d("DHCPv6基础")]),_:1})])])])}const M=p(I,[["render",x],["__file","IPv6动态寻址.html.vue"]]);export{M as default};
