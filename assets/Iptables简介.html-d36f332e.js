import{_ as t,W as p,X as i,Y as n,Z as a,$ as l,a1 as s,C as r}from"./framework-b57ab25f.js";const c="/assets/6b25093691631632e406caa95efc2073-a4502043.png",o="/assets/df690840d9438f00db495afccc570234-34a4d789.png",u="/assets/38580d12214b7e58866fe1fff9621e13-aa6e5d91.png",d="data:image/png;base64,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",b="/assets/e1eb5afdea68acf1794cf4eb5bd1e3e6-db5933d5.png",m={},v=s('<h1 id="iptables简介" tabindex="-1"><a class="header-anchor" href="#iptables简介" aria-hidden="true">#</a> Iptables简介</h1><h2 id="_1-iptables" tabindex="-1"><a class="header-anchor" href="#_1-iptables" aria-hidden="true">#</a> 1. iptables</h2><p>iptables是运行在用户空间的软件，通过控制内核中的netfilter模块来实现对网络的管理。实际上我们只是通过iptables来对内核中的netfilter的规则进行修改，netfilter才是实际工作的模块。</p><p>通常来说iptables仅用于处理IPv4数据包，对于IPv6需要使用ip6tables命令。</p><h2 id="_2-netfilter" tabindex="-1"><a class="header-anchor" href="#_2-netfilter" aria-hidden="true">#</a> 2. netfilter</h2><p>netfilter是在linux内核中的一个软件框架，用于管理网络数据包。有：网络地址转换、数据包修改、数据包过滤、防火墙等功能。</p><p>我们可以使用用户空间中的iptables、nftables、ebtables和arptables等软件来控制netfilter，进而管理通过本系统的数据包。</p><h2 id="_3-基本概念" tabindex="-1"><a class="header-anchor" href="#_3-基本概念" aria-hidden="true">#</a> 3. 基本概念</h2><p>iptables根据规则来对数据包进行管理，一条规则包含：动作、源地址、目的地址、协议等信息。</p><p>协议可以查看<code>/etc/protocols/</code>中定义的协议类型，可使用名字(不区分大小写)、对应编号。缺省值为0，代表tcp、udp、icmp而不是定义的所有协议类型。</p><h3 id="_3-1-五链" tabindex="-1"><a class="header-anchor" href="#_3-1-五链" aria-hidden="true">#</a> 3.1. 五链</h3><p><img src="'+c+'" alt="五链" loading="lazy"> 五链就是指图中的：prerouting、input、forward、postrouting、output五种数据包动作。 例如：</p><ol><li>到本机某进程的数据包：prerouting、input</li><li>进过本机转发的数据包：prerouting、forward、postrouting</li><li>本机发出的数据包：output、postrouting</li></ol><h3 id="_3-2-四表" tabindex="-1"><a class="header-anchor" href="#_3-2-四表" aria-hidden="true">#</a> 3.2. 四表</h3><p>iptables把功能相似的规则放在同一张表中，默认为我们创建了四张表：</p><ul><li>filter：过滤数据包。内核模块：iptables_filter</li><li>nat：网络地址转换。内核模块：iptable_nat</li><li>mangle：拆解、修改、重新发送数据包。内核模块：iptable_mangle</li><li>raw：决定数据包是否被状态跟踪机制处理。内核模块：iptable_raw</li></ul><h3 id="_3-3-链和表的关系" tabindex="-1"><a class="header-anchor" href="#_3-3-链和表的关系" aria-hidden="true">#</a> 3.3. 链和表的关系</h3><p>不同表能作用的链的关系如表：</p><table><thead><tr><th>四表/五链</th><th>PREROUTING</th><th>INPUT</th><th>FORWARD</th><th>OUTPUT</th><th>POSTROUTING</th></tr></thead><tbody><tr><td>filter</td><td></td><td>√</td><td>√</td><td>√</td><td></td></tr><tr><td>nat</td><td>√</td><td>√(centos7)</td><td></td><td>√</td><td>√</td></tr><tr><td>mangle</td><td>√</td><td>√</td><td>√</td><td>√</td><td>√</td></tr><tr><td>raw</td><td>√</td><td></td><td></td><td>√</td><td></td></tr></tbody></table><p>表的优先级关系：raw &gt; mangle &gt; nat &gt; filter，raw的最高。</p><figure><img src="'+o+'" alt="链和表的关系" tabindex="0" loading="lazy"><figcaption>链和表的关系</figcaption></figure><figure><img src="'+u+`" alt="数据包处理流程" tabindex="0" loading="lazy"><figcaption>数据包处理流程</figcaption></figure><h2 id="_4-规则" tabindex="-1"><a class="header-anchor" href="#_4-规则" aria-hidden="true">#</a> 4. 规则</h2><p>规则是根据指定的匹配条件来尝试匹配每个流经此处的报文，一旦匹配成功，则由规则后面指定的处理动作进行处理。</p><h3 id="_4-1-匹配条件" tabindex="-1"><a class="header-anchor" href="#_4-1-匹配条件" aria-hidden="true">#</a> 4.1. 匹配条件</h3><p>匹配条件分为基本匹配条件与扩展匹配条件：</p><ul><li>基本匹配条件： 源地址Source IP，目标地址 Destination IP 上述内容都可以作为基本匹配条件。</li><li>扩展匹配条件： 除了上述的条件可以用于匹配，还有很多其他的条件可以用于匹配，这些条件泛称为扩展条件，这些扩展条件其实也是netfilter中的一部分，只是以模块的形式存在，如果想要使用这些条件，则需要依赖对应的扩展模块。</li></ul><p>下面仅列出常用的简单匹配规则。</p><h4 id="_4-1-1-ip地址匹配" tabindex="-1"><a class="header-anchor" href="#_4-1-1-ip地址匹配" aria-hidden="true">#</a> 4.1.1 IP地址匹配</h4><p>我们可以使用<code>-s</code>和<code>-d</code>指定匹配源IP和目的IP，还可以使用<code>!</code>来表示取反，多个规则时使用<code>,</code>号隔开。例如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 单个匹配</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">1.1</span>.1.2 <span class="token parameter variable">-j</span> DROP

<span class="token comment"># 多个匹配</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">1.1</span>.1.3,1.1.1.4 <span class="token parameter variable">-j</span> DROP

<span class="token comment"># 网段匹配</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">1.1</span>.1.5/23 <span class="token parameter variable">-j</span> DROP

<span class="token comment"># 取反匹配</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token operator">!</span> <span class="token parameter variable">-s</span> <span class="token number">1.1</span>.1.6 <span class="token parameter variable">-j</span> ACCEPT

<span class="token comment"># 源和目的IP匹配</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">1.1</span>.1.7 <span class="token parameter variable">-d</span> <span class="token number">1.1</span>.1.8 <span class="token parameter variable">-j</span> DROP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-1-2-协议匹配" tabindex="-1"><a class="header-anchor" href="#_4-1-2-协议匹配" aria-hidden="true">#</a> 4.1.2 协议匹配</h4>`,32),k=n("code",null,"-p",-1),h=n("code",null,"/etc/protocols",-1),A={href:"https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml",target:"_blank",rel:"noopener noreferrer"},f=s(`<p>在指定IP地址匹配的同时可指定具体协议，例如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 不响应指定源IP的ping数据包</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">1.1</span>.1.2 <span class="token parameter variable">-p</span> icmp <span class="token parameter variable">-j</span> DROP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-1-3-接口匹配" tabindex="-1"><a class="header-anchor" href="#_4-1-3-接口匹配" aria-hidden="true">#</a> 4.1.3 接口匹配</h4><p>我们还可以使用<code>-i</code>和<code>-o</code>参数根据流入和流出的接口来匹配。<code>-i</code>匹配流入的网卡，作用于PREROUTING、INPUT、FORWARD；<code>-o</code>匹配流出的网卡，作用于FORWARD、OUTPUT、POSTROUTING。</p><h4 id="_4-1-4-端口匹配" tabindex="-1"><a class="header-anchor" href="#_4-1-4-端口匹配" aria-hidden="true">#</a> 4.1.4 端口匹配</h4><p>端口匹配属于扩展匹配条件，需要依赖扩展模块。</p><ol><li><p>单端口匹配</p><p>单端口匹配依赖tcp扩展模块，使用<code>-m tcp</code>指定扩展模块，然后使用<code>--dport</code>指定目的端口；<code>--sport</code>指定源端口。以<code>22:55</code>的形式指定端口范围。例如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 丢弃来自1.1.1.2的tcp协议且目的端口是22的数据包</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">1.1</span>.1.2 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> DROP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>多端口匹配</p><p>多端口匹配适用于同时指定多个离散的端口，需要依赖multiport扩展模块。例如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">1.1</span>.1.2 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> multiport <span class="token parameter variable">--dports</span> <span class="token number">22,36</span>,80 <span class="token parameter variable">-j</span> DROP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h3 id="_4-2-处理动作" tabindex="-1"><a class="header-anchor" href="#_4-2-处理动作" aria-hidden="true">#</a> 4.2. 处理动作</h3><p>处理动作在iptables中被称为target（这样说并不准确，我们暂且这样称呼），动作也可以分为基本动作和扩展动作。 此处列出一些常用的动作，之后的文章会对它们进行详细的示例与总结：</p><ul><li><p>ACCEPT：允许数据包通过。</p></li><li><p>DROP：直接丢弃数据包，不给任何回应信息，这时候客户端会感觉自己的请求泥牛入海了，过了超时时间才会有反应。</p></li><li><p>REJECT：拒绝数据包通过，必要时会给数据发送端一个响应的信息，客户端刚请求就会收到拒绝的信息。</p><p>可附加<code>–reject-with</code>参数，指定拒绝对方时的响应类型，缺省为icmp-port-unreachable。可指定的类型有：icmp-net-unreachable、icmp-host-unreachable、icmp-port-unreachable、icmp-proto-unreachable、icmp-net-prohibited、icmp-host-pro-hibited、icmp-admin-prohibited。</p></li><li><p>SNAT：源地址转换，解决内网用户用同一个公网地址上网的问题。</p></li><li><p>MASQUERADE：是SNAT的一种特殊形式，适用于动态的、临时会变的ip上。</p></li><li><p>DNAT：目标地址转换。</p></li><li><p>REDIRECT：在本机做端口映射。</p></li><li><p>LOG：在/var/log/messages文件中记录日志信息，然后将数据包传递给下一条规则，也就是说除了记录以外不对数据包做任何其他操作，仍然让下一条规则去匹配。</p></li></ul><p>补充一下DROP和REJECT的区别。DROP是直接把匹配到的报文丢弃，REJECT除了把报文丢弃还会给该报文中的源IP发一个ICMP报文说明目的不可达(直接回复不可达, 更强硬)。前者报文发送方只能等超时，而后者发送方因为收到了ICMP不可达所以马上就给出了提示。</p><h2 id="_5-命令使用" tabindex="-1"><a class="header-anchor" href="#_5-命令使用" aria-hidden="true">#</a> 5. 命令使用</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>~ <span class="token comment"># iptables -h</span>
iptables v1.4.21

Usage: iptables -<span class="token punctuation">[</span>ACD<span class="token punctuation">]</span> chain rule-specification <span class="token punctuation">[</span>options<span class="token punctuation">]</span>
       iptables <span class="token parameter variable">-I</span> chain <span class="token punctuation">[</span>rulenum<span class="token punctuation">]</span> rule-specification <span class="token punctuation">[</span>options<span class="token punctuation">]</span>
       iptables <span class="token parameter variable">-R</span> chain rulenum rule-specification <span class="token punctuation">[</span>options<span class="token punctuation">]</span>
       iptables <span class="token parameter variable">-D</span> chain rulenum <span class="token punctuation">[</span>options<span class="token punctuation">]</span>
       iptables -<span class="token punctuation">[</span>LS<span class="token punctuation">]</span> <span class="token punctuation">[</span>chain <span class="token punctuation">[</span>rulenum<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span>
       iptables -<span class="token punctuation">[</span>FZ<span class="token punctuation">]</span> <span class="token punctuation">[</span>chain<span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span>
       iptables -<span class="token punctuation">[</span>NX<span class="token punctuation">]</span> chain
       iptables <span class="token parameter variable">-E</span> old-chain-name new-chain-name
       iptables <span class="token parameter variable">-P</span> chain target <span class="token punctuation">[</span>options<span class="token punctuation">]</span>
       iptables <span class="token parameter variable">-h</span> <span class="token punctuation">(</span>print this <span class="token builtin class-name">help</span> information<span class="token punctuation">)</span>

Commands:
Either long or short options are allowed.
  <span class="token parameter variable">--append</span>  <span class="token parameter variable">-A</span> chain Append to chain
  <span class="token parameter variable">--check</span>   <span class="token parameter variable">-C</span> chain  Check <span class="token keyword">for</span> the existence of a rule
  <span class="token parameter variable">--delete</span>  <span class="token parameter variable">-D</span> chain  Delete matching rule from chain
  <span class="token parameter variable">--delete</span>  <span class="token parameter variable">-D</span> chain rulenum
        Delete rule rulenum <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">=</span> first<span class="token punctuation">)</span> from chain
  <span class="token parameter variable">--insert</span>  <span class="token parameter variable">-I</span> chain <span class="token punctuation">[</span>rulenum<span class="token punctuation">]</span>
        Insert <span class="token keyword">in</span> chain as rulenum <span class="token punctuation">(</span>default <span class="token assign-left variable">1</span><span class="token operator">=</span>first<span class="token punctuation">)</span>
  <span class="token parameter variable">--replace</span> <span class="token parameter variable">-R</span> chain rulenum
        Replace rule rulenum <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">=</span> first<span class="token punctuation">)</span> <span class="token keyword">in</span> chain
  <span class="token parameter variable">--list</span>    <span class="token parameter variable">-L</span> <span class="token punctuation">[</span>chain <span class="token punctuation">[</span>rulenum<span class="token punctuation">]</span><span class="token punctuation">]</span>
        List the rules <span class="token keyword">in</span> a chain or all chains
  --list-rules <span class="token parameter variable">-S</span> <span class="token punctuation">[</span>chain <span class="token punctuation">[</span>rulenum<span class="token punctuation">]</span><span class="token punctuation">]</span>
        Print the rules <span class="token keyword">in</span> a chain or all chains
  <span class="token parameter variable">--flush</span>   <span class="token parameter variable">-F</span> <span class="token punctuation">[</span>chain<span class="token punctuation">]</span>    Delete all rules <span class="token keyword">in</span>  chain or all chains
  <span class="token parameter variable">--zero</span>    <span class="token parameter variable">-Z</span> <span class="token punctuation">[</span>chain <span class="token punctuation">[</span>rulenum<span class="token punctuation">]</span><span class="token punctuation">]</span>
        Zero counters <span class="token keyword">in</span> chain or all chains
  <span class="token parameter variable">--new</span>     <span class="token parameter variable">-N</span> chain    Create a new user-defined chain
  --delete-chain
            <span class="token parameter variable">-X</span> <span class="token punctuation">[</span>chain<span class="token punctuation">]</span>    Delete a user-defined chain
  <span class="token parameter variable">--policy</span>  <span class="token parameter variable">-P</span> chain target
        Change policy on chain to target
  --rename-chain
            <span class="token parameter variable">-E</span> old-chain new-chain
        Change chain name, <span class="token punctuation">(</span>moving any references<span class="token punctuation">)</span>
Options:
    <span class="token parameter variable">--ipv4</span>  <span class="token parameter variable">-4</span>    Nothing <span class="token punctuation">(</span>line is ignored by ip6tables-restore<span class="token punctuation">)</span>
    <span class="token parameter variable">--ipv6</span>  <span class="token parameter variable">-6</span>    Error <span class="token punctuation">(</span>line is ignored by iptables-restore<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> <span class="token parameter variable">--protocol</span>  <span class="token parameter variable">-p</span> proto  protocol: by number or name, eg. <span class="token variable"><span class="token variable">\`</span>tcp&#39;
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> <span class="token parameter variable">--source</span>  <span class="token parameter variable">-s</span> address<span class="token punctuation">[</span>/mask<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>
        <span class="token builtin class-name">source</span> specification
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> <span class="token parameter variable">--destination</span> <span class="token parameter variable">-d</span> address<span class="token punctuation">[</span>/mask<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>
        destination specification
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> --in-interface <span class="token parameter variable">-i</span> input name<span class="token punctuation">[</span>+<span class="token punctuation">]</span>
        network interface name <span class="token punctuation">(</span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token keyword">for</span> wildcard<span class="token punctuation">)</span>
 <span class="token parameter variable">--jump</span> <span class="token parameter variable">-j</span> target
        target <span class="token keyword">for</span> rule <span class="token punctuation">(</span>may load target extension<span class="token punctuation">)</span>
  <span class="token parameter variable">--goto</span>      <span class="token parameter variable">-g</span> chain
                              jump to chain with no <span class="token builtin class-name">return</span>
  <span class="token parameter variable">--match</span> <span class="token parameter variable">-m</span> match
        extended match <span class="token punctuation">(</span>may load extension<span class="token punctuation">)</span>
  <span class="token parameter variable">--numeric</span> <span class="token parameter variable">-n</span>    numeric output of addresses and ports
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> --out-interface <span class="token parameter variable">-o</span> output name<span class="token punctuation">[</span>+<span class="token punctuation">]</span>
        network interface name <span class="token punctuation">(</span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token keyword">for</span> wildcard<span class="token punctuation">)</span>
  <span class="token parameter variable">--table</span> <span class="token parameter variable">-t</span> table  table to manipulate <span class="token punctuation">(</span>default: <span class="token variable">\`</span></span>filter&#39;<span class="token punctuation">)</span>
  <span class="token parameter variable">--verbose</span> <span class="token parameter variable">-v</span>    verbose mode
  <span class="token parameter variable">--wait</span>  <span class="token parameter variable">-w</span>    <span class="token function">wait</span> <span class="token keyword">for</span> the xtables lock
  --line-numbers    print line numbers when listing
  <span class="token parameter variable">--exact</span> <span class="token parameter variable">-x</span>    <span class="token function">expand</span> numbers <span class="token punctuation">(</span>display exact values<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> <span class="token parameter variable">--fragment</span>  <span class="token parameter variable">-f</span>    match second or further fragments only
  <span class="token parameter variable">--modprobe</span><span class="token operator">=</span><span class="token operator">&lt;</span>command<span class="token operator">&gt;</span>    try to insert modules using this <span class="token builtin class-name">command</span>
  --set-counters PKTS BYTES <span class="token builtin class-name">set</span> the counter during insert/append
<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> <span class="token parameter variable">--version</span> <span class="token parameter variable">-V</span>    print package version.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-filter表实践" tabindex="-1"><a class="header-anchor" href="#_6-filter表实践" aria-hidden="true">#</a> 6. filter表实践</h2><p>filter是负责数据包过滤的表，是我们最常用的表。</p><p>首先查看filter表中原有的规则：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>~ <span class="token comment"># iptables -t filter -nvL --line</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">6214</span> packets, 569K bytes<span class="token punctuation">)</span>
num   pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination         
<span class="token number">1</span>     <span class="token number">9889</span> 1160K ACCEPT     all  --  eth0.1 *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            state RELATED,ESTABLISHED
<span class="token number">2</span>        <span class="token number">5</span>   <span class="token number">320</span> DROP       icmp --  eth0.1 *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            icmptype <span class="token number">8</span>
<span class="token number">3</span>     <span class="token number">7007</span>  630K access_ctrl  all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0           
<span class="token number">4</span>      <span class="token number">522</span> <span class="token number">34807</span> DROP       all  --  eth0.1 *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0           

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">26932</span> packets, 6125K bytes<span class="token punctuation">)</span>
num   pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination         

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">32373</span> packets, 8525K bytes<span class="token punctuation">)</span>
num   pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination         
<span class="token number">1</span>     <span class="token number">1354</span> <span class="token number">83951</span> dns_drop   udp  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            udp dpt:53 state NEW

Chain access_ctrl <span class="token punctuation">(</span><span class="token number">1</span> references<span class="token punctuation">)</span>
num   pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination         
<span class="token number">1</span>        <span class="token number">0</span>     <span class="token number">0</span> ACCEPT     icmp --  eth0.1 *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0           
<span class="token number">2</span>        <span class="token number">0</span>     <span class="token number">0</span> ACCEPT     tcp  --  eth0.1 *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            tcp dpt:1723
<span class="token number">3</span>        <span class="token number">0</span>     <span class="token number">0</span> ACCEPT     udp  --  eth0.1 *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0            udp dpt:1701
<span class="token number">4</span>        <span class="token number">0</span>     <span class="token number">0</span> ACCEPT     <span class="token number">41</span>   --  eth0.1 *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0           

Chain dns_drop <span class="token punctuation">(</span><span class="token number">1</span> references<span class="token punctuation">)</span>
num   pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination         
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加不响应测试主机ping的规则：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>~ <span class="token comment"># iptables -I INPUT -s 192.168.1.141 -p icmp -j DROP</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>测试：</p><figure><img src="`+d+`" alt="添加规则后测试" tabindex="0" loading="lazy"><figcaption>添加规则后测试</figcaption></figure><p>删除规则：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>~ <span class="token comment"># iptables -L INPUT --line</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
num  target     prot opt <span class="token builtin class-name">source</span>               destination         
<span class="token number">1</span>    DROP       icmp --  <span class="token number">192.168</span>.1.141        anywhere            
<span class="token number">2</span>    ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED
<span class="token number">3</span>    DROP       icmp --  anywhere             anywhere             icmp echo-request
<span class="token number">4</span>    access_ctrl  all  --  anywhere             anywhere            
<span class="token number">5</span>    DROP       all  --  anywhere             anywhere            
~ <span class="token comment"># iptables -D INPUT 1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再次测试：</p><figure><img src="`+b+'" alt="删除规则后测试" tabindex="0" loading="lazy"><figcaption>删除规则后测试</figcaption></figure>',25);function g(P,C){const e=r("ExternalLinkIcon");return p(),i("div",null,[v,n("p",null,[a("我们可以使用"),k,a("指定匹配的协议，可使用协议名称(不区分大小写)，或对应编号。支持协议可查看"),h,a("中的内容，也可以查看相关"),n("a",A,[a("RFC文档定义的协议和对应编号"),l(e)]),a("。")]),f])}const y=t(m,[["render",g],["__file","Iptables简介.html.vue"]]);export{y as default};
